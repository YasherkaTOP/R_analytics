# Отчёт о работе

Анализ факторов, влияющих на потребительскую активность населения, а также приверженность жителей регионов совершать безналичные платежи и брать ипотеку.

## Факторы, применяемые в исследовании:

-   средняя заработная плата

-   число активных абонентов беспроводного назменого фиксированного доступа к сети Интернет

-   уровень безработицы населения

## Загрузка и первичное исследование данных:

#### Импорт библиотек

```{r}
library(tidyverse)
library(readxl)
library(lmtest)
library(sandwich)
library(pROC)
library(stargazer)
```

#### Загрузка и преобразование

```{r}
data <- read_excel("Данные 2020.xlsx")
data <- data %>%
  mutate(Сезон = case_when(
    Месяц %in% c("Декабрь", "Январь", "Февраль") ~ "зима",
    Месяц %in% c("Март", "Апрель", "Май") ~ "весна",
    Месяц %in% c("Июнь", "Июль", "Август") ~ "лето",
    Месяц %in% c("Сентябрь", "Октябрь", "Ноябрь") ~ "осень",
  ))
```

#### Корелляционный анализ факторов

```{r}
cor(data[, c(3, 5, 6)])
```

Вывод: Факторы не являются зависимыми.

## Каким образом потребительская активность зависит от факторов?

#### Построение модели и вывод коэффициентов

```{r}
model_CA <- lm(`Индекс ПА` ~ `Ур. безработицы` + `Заработная плата` + `Активные абоненты` + Сезон, data = data)

summary(model_CA)
```

#### Проверка модели на ошибки в определённых значениях

```{r}
data$fitted <- model_CA$fitted.values
data$residuals <- model_CA$residuals
ggplot(data = data, aes(x = fitted, y = residuals)) + geom_point() + geom_hline(yintercept = 0, color = "red")
```

Вывод: Модель не ошибается чаще в определённых значениях.

#### Проверка модели на сильно влияющие данные

```{r}
plot(model_CA, 5)
```

Вывод: Здесь нет значений с большой степенью влияния.

#### Интерпретация вывода модели

```{r}
stargazer(model_CA, type = "text")
```

Выводы:

-   Каждое увеличение уровня безработицы на одну единицу связано с уменьшением индекса ПА на примерно 0.52 (соответствующее значение коэффициента регрессии). Таким образом, более высокий уровень безработицы ассоциирован с более низким индексом ПА.

-   Cтатистическая значимость Средней заработной платы близка к порогу (уровень значимости p = 0.04634). Это означает, что при увеличении средней заработной платы на одну единицу, Индекс ПА снижается на очень маленькое значение 0.00002.

-   Каждое увеличение числа активных абонентов на одну единицу связано с увеличением индекса ПА на примерно 0.0001155 (соответствующее значение коэффициента регрессии). Статистически значимый коэффициент (уровень значимости p = 0.00314) указывает на то, что число активных абонентов имеет влияние на индекс ПА.

Таким образом, можно сделать выводы о влиянии средней заработной платы, числа активных абонентов и уровня безработицы на индекс ПА.

## Каким образом доля безнал платежей зависит от факторов?

#### Построение модели и вывод коэффициентов

```{r}
model_BP <- lm(`Доля БП в торг. обороте` ~ `Заработная плата` + `Активные абоненты` +`Ур. безработицы` + Сезон, data = data)

summary(model_BP)
```

#### Проверка модели на ошибки в определённых значениях

```{r}
data$fitted <- model_BP$fitted.values
data$residuals <- model_BP$residuals
ggplot(data = data, aes(x = fitted, y = residuals)) + geom_point() + geom_hline(yintercept = 0, color = "red")
```

Вывод: Модель часто ошибается на низких значениях, значит применяем метод исправления.

#### Проверка модели на сильно влияющие данные

```{r}
plot(model_BP, 5)
```

Вывод: Здесь нет значений с большой степенью влияния.

#### Интерпретация вывода модели (с учётом исправления)

```{r}
stargazer(coeftest(model_BP, vcov = vcovHC(model_BP, type="HC0")), type = "text")
```

Выводы:

-   Каждое увеличение средней заработной платы на одну единицу связано с увеличением доли БП в торговом обороте на приблизительно 0.0002 (соответствующее значение коэффициента регрессии). Этот коэффициент является статистически значимым.

-   Каждое увеличение числа активных абонентов на одну единицу связано с уменьшением доли БП в торговом обороте на примерно 0.0001 (соответствующее значение коэффициента регрессии). Этот коэффициент также статистически значим.

-   Каждое увеличение уровня безработицы на одну единицу связано с уменьшением доли БП в торговом оборотена примерно 1.381 (соответствующее значение коэффициента регрессии). Этот коэффициент также является статистически значимым.

Таким образом, можно сделать выводы о влиянии средней заработной платы, числа активных абонентов и уровня безработицы на долю БП в торговом обороте.

## Добавление новых столбцов для анализа

#### Добавление столбца: склонность населения предпочитать онлайн-услуги банка

```{r}
data <- data %>%
  mutate(`Предпочтение онлайн-услуг банка` = ifelse(`Доля онлайн-заявок` > `Доля заявок в офисе банка`, 1, 0))
data$`Предпочтение онлайн-услуг банка` <- as.factor(data$`Предпочтение онлайн-услуг банка`)
```

#### Добавление столбца: склонность населения оформлять ипотеку

```{r}
data <- data %>%
  mutate(
    `Предпочтение ипотеки` = case_when(
      `Всего ипотечных сделок` == "10 - 50" ~ 0,
      `Всего ипотечных сделок` == "50 - 100" ~ 0,
      `Всего ипотечных сделок` == "100 - 500" ~ 0,
      `Всего ипотечных сделок` == "500 - 1 000" ~ 1,
      `Всего ипотечных сделок` == "> 1 000" ~ 1
    )
  )
data$`Предпочтение ипотеки` <- as.factor(data$`Предпочтение ипотеки`)
```

## Каким образом склонность населения предпочитать онлайн-улсуги банка зависит от факторов?

#### Построение модели и вывод коэффициентов

```{r}
model_online_bank <- glm(`Предпочтение онлайн-услуг банка` ~ `Заработная плата` + `Активные абоненты` +`Ур. безработицы` + Сезон, data = data, family = "binomial")

summary(model_online_bank)
```

#### Проверка качества модели

```{r}
roc_data <- roc(data$`Предпочтение онлайн-услуг банка` ~ model_online_bank$fitted.values)
plot(roc_data, main = "ROC Curve", col = "blue")
legend("bottomright", legend = paste("AUC =", round(auc(roc_data), 2)), col = "blue", lwd = 1, bty = "n")
```

Вывод: качество модели хорошее.

#### Интерпретация вывода модели

```{r}
stargazer(model_online_bank, type = "text")
```

Выводы:

-   Заработная плата: Коэффициент (0.00004) показывает, насколько изменится вероятность предпочтения онлайн-услуг банка при изменении заработной платы на одну единицу. В данном случае, увеличение заработной платы на одну единицу приведет к увеличению вероятности предпочтения онлайн-услуг банка.

-   Активные абоненты: Коэффициент (0.00005) показывает, насколько изменится вероятность предпочтения онлайн-услуг банка при изменении числа активных абонентов на одну единицу. В данном случае, увеличение числа активных абонентов приведет к увеличению вероятности предпочтения онлайн-услуг банка.

-   Уровень безработицы: Коэффициент (0.075) показывает, насколько изменится вероятность предпочтения онлайн-услуг банка при изменении уровня безработицы на одну единицу. В данном случае, увеличение уровня безработицы приведет к увеличению вероятности предпочтения онлайн-услуг банка.

Исходя из этой модели, мы можем сделать выводы о влиянии каждого из факторов на склонность населения предпочитать онлайн-услуги банка в регионе.

## Каким образом склонность населения оформлять ипотеку зависит от факторов?

#### Построение модели и вывод коэффициентов

```{r}
model_mortgage <- glm(`Предпочтение ипотеки` ~ `Заработная плата` + `Активные абоненты` +`Ур. безработицы` + Сезон, data = data, family = "binomial")

summary(model_mortgage)
```

#### Проверка качества модели

```{r}
roc_data <- roc(data$`Предпочтение ипотеки` ~ model_mortgage$fitted.values)
plot(roc_data, main = "ROC Curve", col = "blue")
legend("bottomright", legend = paste("AUC =", round(auc(roc_data), 2)), col = "blue", lwd = 1, bty = "n")
```

Вывод: качество модели хорошее.

#### Интерпретация вывода модели

```{r}
stargazer(model_mortgage, type = "text")
```

Выводы:

-   Коэффициент для заработной платы отрицательный (-0.00001), а также его p-value (\< 0.05), что говорит о статистической значимости. Это указывает на то, что при увеличении средней заработной платы в регионе на единицу, склонность к оформлению ипотеки снижается на 0.00001 единиц.

-   Коэффициент для числа активных абонентов положительный (0.0002), а также его p-value (\< 0.05), что говорит о статистической значимости. Это означает, что при увеличении числа активных абонентов в регионе на единицу, склонность к оформлению ипотеки увеличивается на 0.0002 единиц.

-   Коэффициент для уровня безработицы также отрицательный (-0.223), а его p-value (\< 0.05), что указывает на статистическую значимость. Это означает, что при увеличении уровня безработицы в регионе на единицу, склонность к оформлению ипотеки снижается на 0.223 единиц.

Исходя из этой модели, мы можем сделать выводы о влиянии каждого из факторов на склонность населения к оформлению ипотеки в регионе.
